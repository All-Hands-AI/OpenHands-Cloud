nameOverride: ""
fullnameOverride: ""

replicaCount: 1

image:
  repository: ghcr.io/openhands/runtime-api
  tag: latest
  pullPolicy: Always

imagePullSecrets:
  - name: ghcr-login-secret

serviceAccount:
  create: true
  name: runtime-api-sa
  annotations: {}
  createRBAC: true

runtimeInSameCluster: false
defaultAPIKeySecretName: default-api-key

service:
  type: ClusterIP
  port: 5000

env:
  PYTHONDONTWRITEBYTECODE: "1"
  PYTHONUNBUFFERED: "1"
  DEV_MODE: "false"
  ARTIFACT_REGISTRY_REPOSITORY: "runtime-api-docker-repo"
  ARTIFACT_REGISTRY_LOCATION: "us-central1"
  GCP_REGION: "us-central1"
  STORAGE_CLASS: "standard-rwo"
  INCLUDE_START_PROBE: "true"
  INCLUDE_LIVENESS_PROBE: "true"
  RUNTIME_CLASS: "sysbox-runc"

resources:
  limits:
    cpu: 1
    memory: 4Gi
  requests:
    cpu: 1
    memory: 4Gi

# Unified job settings for both jobs and cronjobs
jobSettings:
  # Resource configuration
  resources:
    limits:
      cpu: 1
      memory: 3Gi
    requests:
      cpu: 1
      memory: 3Gi
  # Timeout settings (30 minutes)
  activeDeadlineSeconds: 1800
  # History limits
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 2

nodeSelector: {}

securityContext: {}

tolerations: []

affinity: {}

postgresql:
  enabled: false
  isFeatureDeploy: false
  primary:
    persistence:
      enabled: false
  auth:
    username: postgres
    password: "" # This should be set externally for security reasons
    existingSecret: postgres-password
    database: runtime_api_db
  service:
    ports:
      postgresql: 5432
  image:
    repository: bitnamilegacy/postgresql

externalDatabase:
  enabled: false
  existingSecret: postgres-password

# External database configuration (used when postgresql.enabled=false)
database:
  create: false # Will only be true for AWS as it can't create the DB in terraform
  secretName: runtime-api-db-credentials # Secret containing external database credentials
  poolSize:
    api: 5 # Pool size for API deployment (default)
    cronjobs: 2 # Pool size for cronjobs (default)
  maxOverflow:
    api: 10 # Max overflow for API deployment (default)
    cronjobs: 5 # Max overflow for cronjobs (default)

helm-release-pruner:
  enabled: false
  job:
    schedule: "0 */4 * * *"
    dryRun: False
  pruneProfiles:
    - olderThan: "1 days ago"
      helmReleaseFilter: "^runtime-api-.*$"
      namespaceFilter: "^runtime-api-.*$"
      maxReleasesToKeep: 10

certificate:
  enabled: false

ingress:
  enabled: false
  host: chart-example.local
  className: traefik
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt
  path: /
  pathType: Prefix
  tls: true

# Base ingress configuration for runtime ingress inheritance
# Only metadata (labels and annotations) will be inherited, not the spec
ingressBase:
  enabled: false
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: base-ingress
    labels:
      app: runtime-api
      environment: production
      team: platform
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      cert-manager.io/cluster-issuer: letsencrypt-prod

autoscaling:
  enabled: true
  minReplicas: 3
  maxReplicas: 6
  targetCPUUtilizationPercentage: 75

cleanup:
  enabled: true
  schedule: "*/5 * * * *"
  idle_seconds: 1200 # Default to 20 minutes
  dead_seconds: 86400 # Default to 1 day

warmRuntimes:
  enabled: false
  configMapName: warm-runtimes-config
  count: 0
  configs:
    - name: default
      image: "ghcr.io/openhands/runtime:c0bb84dfa20b4973effbe938d19ed7342e42d4be-nikolaik"
      working_dir: "/openhands/code/"
      environment: {}
      command:
        - /openhands/micromamba/bin/micromamba
        - run
        - -n
        - openhands
        - poetry
        - run
        - python
        - -u
        - -m
        - openhands.runtime.action_execution_server
        - "60000"
        - --working-dir
        - /workspace
        - --plugins
        - agent_skills
        - jupyter
        - vscode
        - --username
        - root
        - --user-id
        - "0"

# Database cleanup CronJob configuration
dbCleanup:
  enabled: true
  schedule: "0 0 * * *" # Run daily at midnight
  retentionDays: 90 # Number of days to retain runtime objects

# Test API Keys cleanup CronJob configuration
testKeysCleanup:
  enabled: false # Disabled by default, enabled only in feature and staging environments
  schedule: "0 0 * * *" # Run daily at midnight
  retentionDays: 2 # Number of days to retain test API keys

# Pod Status Logger configuration
podStatusLogger:
  enabled: true
  schedule: "*/5 * * * *" # Run every 5 minutes

monitoring:
  enabled: false

datadog:
  enabled: false
  env: "dev"

global:
  security:
    # This allows using the bitnamilegacy image repo.
    # See: https://github.com/bitnami/containers/issues/83267
    allowInsecureImages: true
